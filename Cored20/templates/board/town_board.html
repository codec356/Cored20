{% extends "base.html" %}
{% load static %}

{% block style_src %}
    <link rel="stylesheet" href="{% static 'fancybox/jquery.fancybox.css' %}">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"/>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/dataTables.jqueryui.min.css"/>
{% endblock %}

{% block content %}
    <table width="100%" align="center" cellpadding="0" cellspacing="0">
        <tbody>
        <tr>
            <td id="mw_basic">
                <div style="float:left;position: absolute; padding:15px 0 0 10px">오피-강남권 (기방 : 45업소)</div>
                <div id="search_top">
                    <div class="search_top_box">
                        <input type="text" name="stx" maxlength="50" itemname="검색어" required="" value=""
                               id="search_field" class="search_top_stx">
                        <input type="submit" value="검색" class="search_top_button" id="search_btn"
                               style="padding-top:3px;font-weight:bold">
                    </div>
                    <div style="float:right; margin:-43px 10px 0 0;">
                        <a id="search_btn" href="../bbs/write.php?bo_table=lp_0010">
                            <div style="border:1px solid #999; padding:5px; float:left; margin:10px 0 10px 5px; border-radius: 2px; background-color: #555555; color: white;">
                                <i class="fa fa-pencil"></i> 글쓰기
                            </div>
                        </a>
                    </div>
                </div>
                <div class="clearfix"></div>

                <div id="region-filter">
                    <a data-region-id="0" title="모두">
                        <div class="cat_menu_btn_a">모두<br></div>
                    </a>
                    {% for region in regions %}
                        <a data-region-id="{{ region.id }}" title="{{ region.name }}">
                            <div class="cat_menu_btn">{{ region.name }}<br></div>
                        </a>
                    {% endfor %}
                </div>

                <div class="clearfix"></div>

                <div id="category-filter">
                    <a data-category-id="0" title="모두">
                        <div class="cat_menu_btn_a">모두<br></div>
                    </a>
                    {% for category in categories %}
                        <a data-category-id="{{ category.id }}" title="{{ category.name }}">
                            <div class="cat_menu_btn">{{ category.name }}<br></div>
                        </a>
                    {% endfor %}
                </div>
            </td>
        </tr>
        </tbody>
    </table>
    <div style="all:unset;">
        <table id="town-table" style="background-color: #ffffffba;" width="100%" cellspacing="0" cellpadding="0" border="0" style="width: 100%">
            <thead>
            <tr>
                <td style="text-align: center">번호</td>
                <td style="text-align: center">발표</td>
                <td style="text-align: center">전화 번호</td>
                <td style="text-align: center">별명</td>
            </tr>
            </thead>
        </table>
    </div>

{% endblock %}

{% block scripts_src %}

    <script src="{% static 'js/boards/town_board.js' %}"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/dataTables.jqueryui.min.js"></script>
    <script src="https://cdn.datatables.net/plug-ins/1.10.20/dataRender/datetime.js"></script>
    <script src="{% static 'fancybox/jquery.fancybox.pack.js' %}"></script>
    <script src="{% static 'fancybox/jquery.fancybox.js' %}"></script>
    <script src="{% static 'lib/moment/moment.min.js' %}"></script>
    {#    <script>#}
    {#        let is_auth;#}
    {#        let login_url;#}
    {#        {% if user.is_authenticated %}#}
    {#            is_auth = true;#}
    {#        {% else %}#}
    {#            is_auth = false;#}
    {#            login_url = "{% url 'core:login_url' %}";#}
    {#        {% endif %}#}
    {#        let g_offer_url = "{% url 'core:iframe_offer' offer=99999999999999 %}";#}
    {#        let g_reviews_url = "{% url 'core:iframe_reviews' offer=99999999999999 %}";#}
    {#        const l_need_auth = "{% url 'core:login_url' %}";#}
    {#        const l_ajax_get_offers = "{% url 'core:ajax_get_offers_body' %}";#}
    {#        let l_text_search = '';#}
    {#        let l_town_id = {{ town }};#}
    {#        let l_region_id = 0;#}
    {#        let l_category_id = 0;#}
    {#        const MEDIA_URL = "{{ MEDIA_URL }}";#}
    {#        const l_csrf_token = "{{ csrf_token }}";#}
    {#    </script>#}

    <script>
        let l_town_id = {{ town }};
        let l_region_id = 0;
        let l_category_id = 0;
        let l_text_search;
        const l_csrf_token = "{{ csrf_token }}";
        let TOWN_OFFERS_LIST_JSON_URL = '{% url "core:town_offers_list_json" %}';
        let G_OFFER_PAGE_URL =
            {% if user.is_authenticated %}
                "{% url 'core:page_offer' offer=99999999999999 %}";
            {% else %}
                "{% url 'core:login_url' %}";
            {% endif %}


        $(".offer-iframe").click(function () {
            {% if user.is_authenticated %}
                $.fancybox.open({
                    href: {% if user.is_authenticated %}
                        "{% url 'core:iframe_offer' offer=99999999999999 %}".replace('99999999999999', this.dataset.offerId) {% else %}
                        "{% url 'core:login_url' %}" {% endif %},
                    type: 'iframe',
                    padding: 0,
                    height: 800,
                });
            {% else %}
                location.href = "{% url 'core:login_url' %}";
            {% endif %}
        });
        $(".reviews-iframe").click(function () {
            {% if user.is_authenticated %}
                $.fancybox.open({
                    href: {% if user.is_authenticated %}
                        "{% url 'core:iframe_reviews' offer=99999999999999 %}".replace('99999999999999', this.dataset.offerId) {% else %}
                        "{% url 'core:login_url' %}" {% endif %},
                    type: 'iframe',
                    padding: 0,
                    height: 800,
                    autoSize: false
                });
            {% else %}
                location.href = "{% url 'core:login_url' %}";
            {% endif %}
        });
    </script>
{% endblock %}